Index: kobs-ng-10.12.01/src/mtd.c
===================================================================
--- kobs-ng-10.12.01.orig/src/mtd.c
+++ kobs-ng-10.12.01/src/mtd.c
@@ -611,7 +611,7 @@ struct mtd_data *mtd_open(const struct m
 
 		miu = &mp->info;
 
-		r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_MODE_NORMAL);
+		r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_FILE_MODE_NORMAL);
 		if (r != 0 && r != -ENOTTY) {
 			fprintf(stderr, "mtd: device %s can't switch to normal\n", mp->name);
 			goto out;
@@ -761,8 +761,6 @@ void mtd_close(struct mtd_data *md)
 		mp = &md->part[i];
 
 		if (mp->fd != -1) {
-			(void)ioctl(mp->fd, MEMSETOOBSEL,
-					&mp->old_oobinfo);
 			close(mp->fd);
 		}
 
@@ -799,34 +797,26 @@ int mtd_set_ecc_mode(struct mtd_data *md
 			continue;
 
 		if (ecc == 1) {
-			r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_MODE_NORMAL);
+			r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_FILE_MODE_NORMAL);
 			if (r != 0 && r != -ENOTTY) {
 				fprintf(stderr, "mtd: device %s can't switch to normal\n", mp->name);
 				continue;
 			}
 
 			if (r == -ENOTTY) {
-				r = ioctl(mp->fd, MEMSETOOBSEL, &mp->old_oobinfo);
-				if (r != 0) {
-					fprintf(stderr, "mtd: device %s can't ioctl MEMSETOOBSEL\n", mp->name);
-					continue;
-				}
-				mp->oobinfochanged = 0;
+				fprintf(stderr, "mtd: failed to set MTD_FILE_MODE_NORMAL\n");
+				continue;
 			}
 		} else {
-			r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_MODE_RAW);
+			r = ioctl(mp->fd, MTDFILEMODE, (void *)MTD_FILE_MODE_RAW);
 			if (r != 0 && r != -ENOTTY) {
 				fprintf(stderr, "mtd: device %s can't switch to RAW\n", mp->name);
 				continue;
 			}
 
 			if (r == -ENOTTY) {
-				r = ioctl(mp->fd, MEMSETOOBSEL, &none_oobinfo);
-				if (r != 0) {
-					fprintf(stderr, "mtd: device %s can't ioctl MEMSETOOBSEL\n", mp->name);
-					continue;
-				}
-				mp->oobinfochanged = 1;
+				fprintf(stderr, "mtd: failed to set MTD_FILE_MODE_RAW\n");
+				continue;
 			} else
 				mp->oobinfochanged = 2;
 		}
