From 575588aabd3d5c82e69e51c469130aa48d5aa512 Mon Sep 17 00:00:00 2001
From: Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
Date: Sat, 16 Jul 2011 13:41:40 +0200
Subject: [PATCH 01/10] added BB_SVN_TUNNEL variable

It allows to rewrite svn:// uris for example to svn+proxy://.  This
makes it possible to use a 'proxy' tunnel which pipes the connection
through a https proxy.
---
 lib/bb/fetch2/svn.py | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/bb/fetch2/svn.py b/lib/bb/fetch2/svn.py
index 9a779d2..898e6f0 100644
--- a/lib/bb/fetch2/svn.py
+++ b/lib/bb/fetch2/svn.py
@@ -50,6 +50,7 @@ class Svn(FetchMethod):
             raise MissingParameterError('module', ud.url)
 
         ud.basecmd = d.getVar('FETCHCMD_svn', True)
+        ud.tunnel  = data.getVar('BB_SVN_TUNNEL', d, True) or ""
 
         ud.module = ud.parm["module"]
 
@@ -73,6 +74,9 @@ class Svn(FetchMethod):
 
         proto = ud.parm.get('protocol', 'svn')
 
+        if proto == "svn":
+            proto = proto + ud.tunnel
+
         svn_rsh = None
         if proto == "svn+ssh" and "rsh" in ud.parm:
             svn_rsh = ud.parm["rsh"]
-- 
1.8.1.4

