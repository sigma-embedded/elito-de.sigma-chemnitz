From e2c6fd01baad3197956249c19211ba53f1547fd1 Mon Sep 17 00:00:00 2001
From: Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
Date: Mon, 2 Apr 2012 15:43:06 +0200
Subject: [PATCH 16/19] data: give out configuration hash data

this helps to debug problems
---
 lib/bb/data_smart.py |   14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/lib/bb/data_smart.py b/lib/bb/data_smart.py
index 4c9d501..8def097 100644
--- a/lib/bb/data_smart.py
+++ b/lib/bb/data_smart.py
@@ -476,5 +476,15 @@ class DataSmart(MutableMapping):
             value = self.getVar(key, False) or ""
             data.update({key:value})
 
-        data_str = str([(k, data[k]) for k in sorted(data.keys())])
-        return hashlib.md5(data_str).hexdigest()
+        data_str = [(k, data[k]) for k in sorted(data.keys())]
+
+        if logger.level >= 0:
+            fname = os.path.join(self.getVar("TMPDIR", True) or ".",
+                                 "datahash");
+
+            if os.access(fname + ".curr", os.F_OK):
+                utils.movefile(fname + ".curr", fname + ".prev")
+
+            open(fname + ".curr","w").write('\n'.join(map(lambda x: '%s="%s"' % x, data_str)))
+
+        return hashlib.md5(str(data_str)).hexdigest()
-- 
1.7.10.2

