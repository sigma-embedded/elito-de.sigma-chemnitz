From cec861c0d49a2aeabc5097fe44f84d2009ea891f Mon Sep 17 00:00:00 2001
From: Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
Date: Sat, 16 Jul 2011 13:41:46 +0200
Subject: [PATCH 07/12] added BBMASK_BASENAMES variables

---
 lib/bb/cooker.py |   16 +++++++++++++++-
 1 files changed, 15 insertions(+), 1 deletions(-)

diff --git a/lib/bb/cooker.py b/lib/bb/cooker.py
index 0912871..9a3a8a0 100644
--- a/lib/bb/cooker.py
+++ b/lib/bb/cooker.py
@@ -1266,6 +1266,9 @@ class BBCooker:
                         newfiles.append(g)
 
         bbmask = bb.data.getVar('BBMASK', self.configuration.data, 1)
+        bbmask_basenames = (bb.data.getVar('BBMASK_BASENAMES',
+                                           self.configuration.data, 1)
+                            or "").split()
 
         if bbmask:
             try:
@@ -1273,12 +1276,23 @@ class BBCooker:
             except sre_constants.error:
                 collectlog.critical("BBMASK is not a valid regular expression, ignoring.")
                 return list(newfiles), 0
+        elif not bbmask_basenames:
+            return list(newfiles), 0
+
+        bbmask_dict = {}
+        for f in bbmask_basenames:
+            if not f.endswith('.bb'):
+                f += '.bb'
+
+            bbmask_dict[f] = 1
 
         bbfiles = []
         bbappend = []
         maskedfiles = []
         for f in newfiles:
-            if bbmask and bbmask_compiled.search(f):
+            f_base = os.path.basename(f)
+            if bbmask_dict.has_key(f_base) or (bbmask and
+                                               bbmask_compiled.search(f)):
                 collectlog.debug(2, "skipping masked file %s", f)
                 if collectlog.level >= 1:
                     maskedfiles.append(f)
-- 
1.7.6

