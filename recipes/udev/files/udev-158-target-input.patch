Index: udev-158/Makefile.am
===================================================================
--- udev-158.orig/Makefile.am
+++ udev-158/Makefile.am
@@ -1,6 +1,6 @@
 # ------------------------------------------------------------------------------
 # Copyright (C) 2008-2009 Kay Sievers <kay.sievers@vrfy.org>
-# Copyright (C) 2009 Diego Elio 'Flameeyes' Pettenò <flameeyes@gmail.com>
+# Copyright (C) 2009 Diego Elio 'Flameeyes' PettenÃ² <flameeyes@gmail.com>
 # ------------------------------------------------------------------------------
 
 SUBDIRS = .
@@ -558,9 +558,11 @@ dist_udevkeymapforcerel_DATA = \
 	extras/keymap/force-release-maps/samsung-other \
 	extras/keymap/force-release-maps/common-volume-keys
 
-extras/keymap/keys.txt: $(INCLUDE_PREFIX)/linux/input.h
+extras/keymap/keys.txt:
 	$(AM_V_at)mkdir -p extras/keymap
-	$(AM_V_GEN)$(AWK) '/^#define.*KEY_[^ ]+[ \t]+[0-9]/ { if ($$2 != "KEY_MAX") { print $$2 } }' < $< | sed 's/^KEY_COFFEE$$/KEY_SCREENLOCK/' > $@
+	$(AM_V_GEN)echo '#include <linux/input.h>' | \
+		$(CC) $(CFLAGS) -E -dD - | \
+		$(AWK) '/^#define[ \t]+KEY_/ { if ($$2 != "KEY_MAX" && $$2 != "KEY_CNT") { print $$2 } }' > $@
 
 extras/keymap/keys-from-name.gperf: extras/keymap/keys.txt
 	$(AM_V_GEN)$(AWK) 'BEGIN{ print "struct key { const char* name; unsigned short id; };"; print "%null-strings"; print "%%";} { print $$1 ", " $$1 }' < $< > $@
