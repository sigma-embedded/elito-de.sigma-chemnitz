\chapter{Bootloaders}

\section{Keith\&Koep ``arnoldboot'' (TrizepsIV)}

Three kernel image types:

\begin{description}
\item[\texttt{*-sdram.bin}]
\item[\texttt{*-flash.bin}]
\item[\texttt{*-gdb.bin}]
\end{description}

\begin{verbatim}
fuseburn 9
fuselist
\end{verbatim}



\begin{verbatim}
setbaud com1 115200

boot mmc kernel.img
boot mmc rootfs.img

tftp
\end{verbatim}

\section{Keith\&Koep ``e-boot'' (TrizepsVI)}

Four parts

\begin{description}
\item[\texttt{autoboot.bat}] To be copied into the e-boot boot
  partition. Adjust it to local requirements
\begin{lstlisting}[language=sh]
:) bfmt                     # optionally; erases previous boot partition
:) mount nanddisk
:) del autoboot.bat
:) store mmc2 autoboot.bat  # 'mmc'  ... external slot,
                            # 'mmc2' ... on-module slot
\end{lstlisting}
\item[\texttt{boot.bin}] First stage bootloader; to be copied into the first
  (*FAT) partition of the sd-card
\item[\texttt{zImage-kk-trizeps6.bin}] Flat linux kernel; to be copied
  into the first first (*FAT) partition of the sd-card and renamed to
  \texttt{linux.ram}
\item[\texttt{elito-image-kk-trizeps6.tar.bz2}] RootFS; to be
  extracted into an ext4 partition of the sd-card. Extraction must be
  done as root to set correct file ownership.
\end{description}

\section{Toradex Bootloader (Colibri270)}

\paragraph{NOTE:} Content of this section is preliminary and consists
of extracts from e-mail communication about creation of U-Boot images.
Integration into the buildsystem is missing.  It assumes the Fedora
implementation of the tftp client program.

\subsection{Build CE tools}

\begin{enumerate}
\item Clone the git repository and go into it
\begin{lstlisting}[language=sh]
$ git clone git://git.sigma-chemnitz.de:4815/pub/ce-bootme
$ cd ce-bootme
\end{lstlisting}
\item Build and install it manually
\begin{lstlisting}[language=sh]
$ make && make install
\end{lstlisting}%$
or create an rpm package
\begin{lstlisting}[language=sh]
$ make dist
$ rpmbuild -tb ce-bootme.tar.xz
\end{lstlisting}
\end{enumerate}

The RPM package adds a ``ce-'' prefix to the installed programs which
is used in the examples below. ``ce-bootme'' needs to listen on the
privileged 980/udp port so that it must be started by the ``root''
user or installed with suid permissions (which is done by the RPM
package).

\subsection{Creating .nb images}

\paragraph{NOTE:} This section describes generation of U-Boot images
which are to be loaded at address 0.

\begin{enumerate}
\item create the .nb image from the u-boot.bin image
\begin{lstlisting}[language=sh]
$ ce-data2bin u-boot.bin 0 > u-boot.nb
\end{lstlisting}%$
\end{enumerate}


\subsection{Using .nb images}

\begin{enumerate}
\item install the tftp-client package
\item execute it
\begin{lstlisting}[language=sh]
$ ce-bootme u-boot-SAx.nb COLIBRI\*
\end{lstlisting}%$

\item connect to the ffuart interface of the colibri module with 9600 baud

\item turn off the colibri module

\item press SPACE

\item turn on the colibri module; you will see

\begin{verbatim}
Toradex Bootloader 3.6 for Colibri Built Jun 24 2010

Press [SPACE] to enter Bootloader Menu



BootLoader Configuration:

C) Clear Flash Registry
X) Enter CommandPrompt Mode
D) Download image to RAM now
F) Download image to FLASH now
L) Launch existing flash resident image now
\end{verbatim}

\item press F

\item ce-bootme from step 3 will output something like
\begin{verbatim}
ID: COLIBRI0
mode set to octet
Connected to 192.168.2.126 (192.168.2.126), port 980
putting u-boot-SA0.nb to 192.168.2.126:boot.bin [octet]
Sent 145955 bytes in 6.1 seconds [190260 bit/s]
\end{verbatim}

     and the eboot bootloader

\begin{verbatim}
-EbootSendBootmeAndWaitForTftp
FLASH download [ 0x00000000 ==> 0x00023A37 ]

INFO: FlashErase: 0x00000000 to 0x0002FFFF.  Please wait: 100%
INFO: FlashWrite: 0x00000000 to 0x00023A37.  Please wait: 100%
Flash image. Resetting device...
\end{verbatim}

\end{enumerate}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
