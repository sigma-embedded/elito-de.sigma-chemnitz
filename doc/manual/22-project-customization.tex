\chapter{Project customization}
\label{chap:project-customization}

\section{U-Boot \& Kernel modifications}
\label{sec:project-customization_u-boot+kernel-modifications}

Although OpenEmbedded recipes can be customized by appending
additional patches to the \texttt{SRC\_URI} variable, this is
sometimes unsuitable for large projects like U-Boot or the Linux
Kernel.  Hence, ELiTo puts their source code repositories in a
workspace directory and builds packages based upon a certain
branch. These branches are configured in \texttt{project.conf} in a
way like

\begin{lstlisting}[language=python]
MACHINE_KERNEL_VERSION   = "2.6.31"
KERNEL_BRANCH            = "vendor/platform"
KERNEL_DEFCONFIG         = "platform_defconfig"

UBOOT_VERSION            = "2009.08"
UBOOT_BRANCH             = "vendor/platform"
\end{lstlisting}

For the kernel, the head of the
\texttt{\$\{MACHINE\_KERNEL\_VERSION\}/\$\{KERNEL\_BRANCH\}} branch
from the \texttt{<topdir>/workdir/kernel.git} repository will be used
to build the kernel packages by taking the configuration from
\texttt{\$\{KERNEL\_DEFCONFIG\}}.

Similarily, sources at the head of the
\texttt{\$\{UBOOT\_VERSION\}/\$\{UBOOT\_BRANCH\}} branch in the
\texttt{<topdir>/workdir/u-boot.git} repository will be used to
build the u-boot bootloader.

When doing local modifications, it is recommended to clone these
repositories, create an own branch with this naming scheme, set this
branch in \texttt{project.conf}, develop in this branch and push it
back into the main repository:


\label{sec:project-customization_u-boot+kernel-modifications_clone+modify}
\begin{lstlisting}[language=sh]
#### clone + modify the kernel
cd /srv/elito/bsp/workspace
git clone -l -s kernel.git kernel-my.git
cd kernel-my.git
git checkout --track -b 2.6.31/my-branch origin/2.6.31/vendor/platform
make -f ../Makefile.kernel.$project platform_defconfig

# select other options + drivers
make -f ../Makefile.kernel.$project menuconfig
# place the configuration back
cat .config > arch/arm/configs/platform_defconfig
# commit this new configuration
git commit arch/arm/configs/platform_defconfig

# publish the new branch
git push origin 2.6.31/my-branch

#### register new branch
cd /srv/elito/bsp/$project
vim conf/project.conf
\end{lstlisting}

For U-Boot, steps are similarly but \texttt{make} should be called with
\begin{lstlisting}[language=sh]
make -f ../Makefile.$project CFG=u-boot
\end{lstlisting}

These makefiles are generated while building the project\footnote{\texttt{Makefile.kernel.\$project} is generated by the \texttt{elito-kernel} recipe, the more general \texttt{Makefile.\$project} by the \texttt{elito-develcomp} rules}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
